# tree widget demo
#
# 13-OCT-01 last update

import os
import Tree
from Tkinter import *
globdict={}

class MyNodes(Tree.Node):
    def __init__(self, *args, **kw_args):
        # call superclass
        apply(Tree.Node.__init__, (self,)+args, kw_args)
        # bind right-click
        self.widget.tag_bind(self.symbol, '<3>', self.popup_menu)
        self.widget.tag_bind(self.label, '<3>', self.popup_menu)
				
        globdict[self.full_id()]=self
        
    # pop up menu on right click
    def popup_menu(self, event):
        menu=Menu(self.widget, tearoff=0)
        menu.add_command(label='Foo', command=self.foo)
        menu.add_command(label='Bar', command=self.bar)
        menu.add_command(label='Baz', command=self.baz)
        menu.tk_popup(event.x_root, event.y_root)

    # do this
    def foo(self):
        print 'foo', self.full_id()

    # do that
    def bar(self):
        print 'bar', self.full_id()

    # do the other thing
    def baz(self):
        print 'baz', self.full_id()

def getfiles(node):
    path=apply(os.path.join, node.full_id())
		
    globdict[node.full_id()]=node
    	
    for filename in os.listdir(path):
        full=os.path.join(path, filename)
        name=filename
        folder=0
        if os.path.isdir(full):
            # it's a directory
            folder=1
        elif not os.path.isfile(full):
            # but it's not a file
            name=name+' (special)'
        if os.path.islink(full):
            # it's a link
            name=name+' (link to '+os.readlink(full)+')'
        t.add_node(name=name, id=filename, flag=folder)

def cmd1():
    node = globdict[('/','tmp')]
    node.insert_children(t.add_list(name='lc1',id='lc1'))
    node.insert_children(t.add_list(name='lc2',id='lc2',flag=1))    
root=Tk()
root.title(os.path.basename(sys.argv[0]))

# create the control
t=Tree.Tree(master=root,
            root_id=os.sep,
            root_label=os.sep,
            get_contents_callback=getfiles,
            width=300,
            node_class=MyNodes)
t.grid(row=0, column=0, sticky=N+E+W+S)

root.grid_rowconfigure(0, weight=1)
root.grid_columnconfigure(0, weight=1)
sb=Scrollbar(root)
sb.grid(row=0, column=1, sticky=N+S)
t.configure(yscrollcommand=sb.set)
sb.configure(command=t.yview)
sb=Scrollbar(root, orient=HORIZONTAL)
sb.grid(row=1, column=0, sticky=E+W)
t.configure(xscrollcommand=sb.set)
sb.configure(command=t.xview)
t.focus_set()

b1 = Button(text='Cmd1', command=cmd1)
b1.grid()
    
# expand root
t.root.expand()
print globdict

root.mainloop()
