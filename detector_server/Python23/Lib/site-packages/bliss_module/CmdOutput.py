#!/usr/bin/env python
##########################################################################
# File:         CmdOutput.py
# $Header: /segfs/bliss/source/python/utils/RCS/CmdOutput.py,v 1.0 2002/12/10 10:13:28 ahoms Rel $
# Project:      Bliss Python modules
# Desc:         Get the output output of a system shell command
# Author(s):    A. Homs (ahoms@esrf.fr)
#
# $Log: CmdOutput.py,v $
# Revision 1.0  2002/12/10 10:13:28  ahoms
# Initial release
#
##########################################################################

import os, tempfile
from SimpleRecord import Record

def get_cmd_output(cmd):
    stdout = tempfile.mktemp()
    stderr = tempfile.mktemp()
    shcmd = '%s > %s 2> %s' % (cmd, stdout, stderr)
    ret = os.system(shcmd)

    outlines = ['', '']
    for fname, idx in [(stdout, 0), (stderr, 1)]:
        f = open(fname, 'rt')
        outlines[idx] = f.readlines()
        f.close()
        os.unlink(fname)
    
    return Record(ret=ret, output=outlines[0], error=outlines[1])


if __name__ == '__main__':
    while 1:
        cmd = raw_input('Type the command to execute ("exit" to quit): ')
        if cmd == 'exit':
            break

        record = get_cmd_output(cmd)
        print 'Return value:', record.ret
        print
        for name, lines in [('Command output', record.output),
                            ('Command error', record.error)]:
            print name + ':'
            print '-' * (len(name) + 1)
            for line in lines:
                print line,
            print
            

        
