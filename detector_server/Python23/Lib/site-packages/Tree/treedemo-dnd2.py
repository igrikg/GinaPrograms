# tree widget demo
#
# 27-AUG-01 Last update

import os
import Tree
from Tkinter import *

class Tester:
    def __init__(self, root, name):
        self.name=name
        self.top=Toplevel(root)
        self.top.title(name)
        # create the control
        self.tree=Tree.Tree(master=self.top,
                            root_id=name,
                            root_label=os.sep,
                            get_contents_callback=getfiles,
                            drop_callback=dnd_update,
                            height=400,
                            width=300)
        self.tree.name=name
        sb=Scrollbar(self.top)
        sb.pack(side='right', fill="y", expand=1)
        self.tree.pack(fill="both", expand=1)
        self.tree.configure(yscrollcommand=sb.set)
        sb.configure(command=self.tree.yview)
        #sb=Scrollbar(root, orient=HORIZONTAL)
        #sb.grid(row=1, column=0, sticky=E+W)
        #self.tree.configure(xscrollcommand=sb.set)
        #sb.configure(command=self.tree.xview)
        # expand root
        self.tree.root.expand()
        
def getfiles(node):
    path=apply(os.path.join, node.full_id())
    for filename in os.listdir(path):
        full=os.path.join(path, filename)
        name=filename
        folder=0
        if os.path.isdir(full):
            # it's a directory
            folder=1
        elif not os.path.isfile(full):
            # but it's not a file
            name=name+' (special)'
        if os.path.islink(full):
            # it's a link
            name=name+' (link to '+os.readlink(full)+')'
        node.widget.add_node(name=name, id=filename, flag=folder)

# update on drag'n'drop
def dnd_update(source, target):
        if target == target.widget.root:
            # can't step on the root node
            target.insert_children(
                target.widget.add_list(name=source.get_label(),
                                   id=source.id,
                                   flag=source.expandable_flag,
                                   expanded_icon=source.expanded_icon,
                                   collapsed_icon=source.collapsed_icon))
        else:
            target.insert_before(
                target.widget.add_list(name=source.get_label(),
                                   id=source.id,
                                   flag=source.expandable_flag,
                                   expanded_icon=source.expanded_icon,
                                   collapsed_icon=source.collapsed_icon))
        source.delete()

root=Tk()
root.title("Drag'n'drop")
root.geometry("+1+1")
Button(command=root.quit, text="Quit").pack()

t1=Tester(root, 'dir1')
t1.top.geometry("+1+60")
t2=Tester(root, 'dir2')
t2.top.geometry("+350+60")

root.mainloop()
